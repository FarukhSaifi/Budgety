import{u as B,r as g,b as $,m as L,n as j,j as t,U as n,M as A,C as p,N as d,A as _}from"./index-8lZlQ1VF.js";import{u as k}from"./useDateFormatter-CGYOy8qr.js";import{B as v}from"./Button-BDqJC-5O.js";import{C as H,b as V,a as z}from"./Card-BGTWcXJa.js";import{s as K}from"./toast-CFIaTDC2.js";import{C as W,a as G}from"./ChevronRight-Dp011kP9.js";const te=()=>{const{billReminders:S,recurringTransactions:P,selectedMonth:o,selectedYear:l,dispatch:w}=B(),[c,E]=g.useState(null),{formatCurrency:u}=$(),{formatDate:R}=k(),b=g.useCallback(e=>{const s=new Date;s.setHours(0,0,0,0);const a=new Date(e);a.setHours(0,0,0,0);const r=a-s;return Math.ceil(r/L.MILLISECONDS_PER_DAY)},[]),h=g.useMemo(()=>S.filter(e=>{if(!e.dueDate)return!1;const s=new Date(e.dueDate);return s.getMonth()+1===o&&s.getFullYear()===l}),[S,o,l]),D=g.useMemo(()=>P.filter(e=>{if(!e.startDate||!e.isActive)return!1;const s=new Date(e.startDate),a=s.getMonth()+1,r=s.getFullYear();if(l<r||l===r&&o<a)return!1;if(e.endDate){const i=new Date(e.endDate),f=i.getMonth()+1,m=i.getFullYear();if(l>m||l===m&&o>f)return!1}return e.recurrence===j.MONTHLY?!0:e.recurrence===j.YEARLY?a===o:e.recurrence===j.WEEKLY||e.recurrence===j.DAILY}),[P,o,l]),M=g.useMemo(()=>{const e={};return h.forEach(s=>{const r=new Date(s.dueDate).getDate();e[r]||(e[r]={bills:[],recurring:[],totalAmount:0,overdueCount:0,upcomingCount:0}),e[r].bills.push(s),e[r].totalAmount+=s.amount||0;const i=b(s.dueDate);i<0?e[r].overdueCount++:i<=(s.reminderDays||L.DEFAULT_REMINDER_DAYS)&&e[r].upcomingCount++}),D.forEach(s=>{const a=s.recurrence===j.MONTHLY?1:new Date(s.startDate).getDate();e[a]||(e[a]={bills:[],recurring:[],totalAmount:0,overdueCount:0,upcomingCount:0}),e[a].recurring.push(s),e[a].totalAmount+=s.amount||0}),e},[h,D,b]),I=g.useMemo(()=>{const e=l,s=o-1,a=new Date(e,s,1),i=new Date(e,s+1,0).getDate(),f=a.getDay(),m=[];for(let x=0;x<f;x++)m.push(null);for(let x=1;x<=i;x++)m.push(x);return m},[o,l]),N=e=>!e||!M[e]?{bills:[],recurring:[]}:M[e],T=e=>{let s=o,a=l;e==="prev"?(s-=1,s<1&&(s=12,a-=1)):(s+=1,s>12&&(s=1,a+=1)),w({type:_.SET_VIEW_PERIOD,payload:{viewPeriod:"monthly",selectedMonth:s,selectedYear:a}}),E(null)},Y=()=>{const e=new Date;w({type:_.SET_VIEW_PERIOD,payload:{viewPeriod:"monthly",selectedMonth:e.getMonth()+1,selectedYear:e.getFullYear()}}),E(e.getDate())},F=e=>{w({type:_.MARK_BILL_PAID,payload:e}),K("Bill marked as paid")},O=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],y=new Date,U=o===y.getMonth()+1&&l===y.getFullYear(),C=g.useMemo(()=>{const e=h.filter(r=>!r.isPaid).reduce((r,i)=>r+(i.amount||0),0),s=D.reduce((r,i)=>r+(i.amount||0),0),a=h.filter(r=>r.isPaid?!1:b(r.dueDate)<0).reduce((r,i)=>r+(i.amount||0),0);return{total:e+s,bills:e,recurring:s,overdue:a}},[h,D,b]);return t.jsx("div",{className:"mx-auto mb-2 md:mb-4",children:t.jsxs(H,{children:[t.jsx(V,{bgColor:"bg-orange-500",children:t.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2",children:[t.jsxs("div",{children:[t.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-1",children:n.PAYMENTS_CALENDAR}),t.jsxs("p",{className:"text-sm text-orange-100",children:[A[o-1]," ",l]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(v,{variant:"outline",size:"sm",onClick:Y,className:"bg-white text-orange-600 hover:bg-orange-50 border-white",children:n.TODAY}),t.jsxs("div",{className:"flex items-center gap-1",children:[t.jsx(v,{variant:"ghost",size:"sm",onClick:()=>T("prev"),className:"text-white hover:bg-orange-600",children:t.jsx(W,{})}),t.jsx(v,{variant:"ghost",size:"sm",onClick:()=>T("next"),className:"text-white hover:bg-orange-600",children:t.jsx(G,{})})]})]})]})}),t.jsxs(z,{children:[t.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 md:gap-4 mb-2 md:mb-4",children:[t.jsxs("div",{className:"bg-orange-50 p-2 md:p-4 rounded-lg border border-orange-200",children:[t.jsx("div",{className:"text-xs md:text-sm text-gray-600 mb-1",children:n.TOTAL_PAYMENTS}),t.jsxs("div",{className:"text-base md:text-xl lg:text-2xl font-bold text-orange-600",children:[p,u(C.total,{minimumFractionDigits:d.DECIMAL_PLACES,maximumFractionDigits:d.DECIMAL_PLACES})]})]}),t.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[t.jsx("div",{className:"text-sm text-gray-600 mb-1",children:n.OVERDUE}),t.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-red-600",children:[p,u(C.overdue,{minimumFractionDigits:d.DECIMAL_PLACES,maximumFractionDigits:d.DECIMAL_PLACES})]})]}),t.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:[t.jsx("div",{className:"text-sm text-gray-600 mb-1",children:n.BILLS}),t.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-yellow-600",children:[p,u(C.bills,{minimumFractionDigits:d.DECIMAL_PLACES,maximumFractionDigits:d.DECIMAL_PLACES})]})]}),t.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[t.jsx("div",{className:"text-sm text-gray-600 mb-1",children:n.RECURRING}),t.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-blue-600",children:[p,u(C.recurring,{minimumFractionDigits:d.DECIMAL_PLACES,maximumFractionDigits:d.DECIMAL_PLACES})]})]})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("div",{className:"grid grid-cols-7 gap-2 mb-2",children:O.map(e=>t.jsx("div",{className:"text-center font-semibold text-gray-700 py-2 text-sm sm:text-base",children:e},e))}),t.jsx("div",{className:"grid grid-cols-7 gap-2",children:I.map((e,s)=>{if(e===null)return t.jsx("div",{className:"h-24 sm:h-32 border border-transparent rounded-lg"},`empty-${s}`);const a=M[e],r=!!a,i=U&&e===y.getDate()&&o===y.getMonth()+1&&l===y.getFullYear(),f=c===e;let m="bg-white",x="border-gray-200";return r&&(a.overdueCount>0?(m="bg-red-50",x="border-red-300"):a.upcomingCount>0?(m="bg-yellow-50",x="border-yellow-300"):(m="bg-orange-50",x="border-orange-200")),t.jsx("div",{onClick:()=>E(c===e?null:e),className:`
                      h-24 sm:h-32 border-2 rounded-lg p-1 sm:p-2 cursor-pointer transition-all
                      ${f?"border-blue-500 bg-blue-50 shadow-md":x}
                      ${i?"ring-2 ring-green-400 ring-offset-1":""}
                      ${m}
                    `,children:t.jsxs("div",{className:"flex flex-col h-full",children:[t.jsxs("div",{className:"flex justify-between items-start mb-1",children:[t.jsx("span",{className:`text-sm sm:text-base font-semibold ${i?"text-green-600":f?"text-blue-600":"text-gray-800"}`,children:e}),r&&t.jsx("span",{className:"text-xs font-bold text-orange-600",children:u(a.totalAmount,{compact:!0,minimumFractionDigits:0,maximumFractionDigits:0})})]}),r&&t.jsxs("div",{className:"flex-1 flex flex-col justify-end space-y-0.5",children:[a.overdueCount>0&&t.jsxs("div",{className:"text-xs text-red-600 font-medium truncate",children:["⚠️ ",a.overdueCount," overdue"]}),a.upcomingCount>0&&t.jsxs("div",{className:"text-xs text-yellow-600 font-medium truncate",children:["⏰ ",a.upcomingCount," due soon"]}),a.bills.length>0&&t.jsxs("div",{className:"text-xs text-gray-600 font-medium",children:[a.bills.length," bill",a.bills.length>1?"s":""]}),a.recurring.length>0&&t.jsxs("div",{className:"text-xs text-blue-600 font-medium",children:[a.recurring.length," recurring"]})]})]})},e)})})]}),c&&N(c).bills.length>0&&t.jsxs("div",{className:"mt-6 border-t pt-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("h4",{className:"text-lg sm:text-xl font-semibold text-gray-800",children:[n.PAYMENTS_FOR," ",c," ",A[o-1]," ",l]}),t.jsx(v,{variant:"ghost",size:"sm",onClick:()=>E(null),className:"text-gray-600",children:n.CLOSE})]}),t.jsxs("div",{className:"space-y-3",children:[N(c).bills.map(e=>{const s=b(e.dueDate),a=s<0,r=s>=0&&s<=(e.reminderDays||L.DEFAULT_REMINDER_DAYS);return t.jsxs("div",{className:`
                        flex flex-col sm:flex-row sm:justify-between sm:items-center p-4 rounded-lg border-l-4 shadow-sm
                        ${e.isPaid?"bg-gray-50 border-gray-400 opacity-60":a?"bg-red-50 border-red-500":r?"bg-yellow-50 border-yellow-500":"bg-orange-50 border-orange-500"}
                      `,children:[t.jsxs("div",{className:"flex-1 mb-2 sm:mb-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"font-semibold text-gray-800",children:e.name}),e.isPaid&&t.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded",children:n.PAID}),!e.isPaid&&a&&t.jsx("span",{className:"px-2 py-1 bg-red-100 text-red-800 text-xs font-medium rounded",children:n.OVERDUE}),!e.isPaid&&r&&t.jsx("span",{className:"px-2 py-1 bg-yellow-100 text-yellow-800 text-xs font-medium rounded",children:n.DUE_SOON})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-gray-600",children:[e.category&&t.jsx("span",{className:"px-2 py-1 bg-white rounded text-xs font-medium",children:e.category}),t.jsxs("span",{className:"text-xs",children:[n.DUE," ",R(e.dueDate,"short")]}),!e.isPaid&&t.jsx("span",{className:"text-xs",children:a?`${Math.abs(s)} ${n.DAYS_OVERDUE}`:`${s} ${n.DAYS_LEFT}`})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsxs("div",{className:`
                            text-lg sm:text-xl font-bold whitespace-nowrap
                            ${e.isPaid?"text-gray-500":"text-orange-600"}
                          `,children:[p,u(e.amount,{minimumFractionDigits:d.DECIMAL_PLACES,maximumFractionDigits:d.DECIMAL_PLACES})]}),!e.isPaid&&t.jsx(v,{variant:"primary",size:"sm",onClick:()=>F(e.id),className:"bg-green-600 hover:bg-green-700 text-white",children:n.MARK_AS_PAID})]})]},e.id)}),N(c).recurring.map(e=>t.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center p-4 rounded-lg border-l-4 border-blue-500 bg-blue-50 shadow-sm",children:[t.jsxs("div",{className:"flex-1 mb-2 sm:mb-0",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[t.jsx("span",{className:"font-semibold text-gray-800",children:e.description||n.RECURRING_PAYMENT}),t.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded",children:e.recurrence})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-sm text-gray-600",children:[e.category&&t.jsx("span",{className:"px-2 py-1 bg-white rounded text-xs font-medium",children:e.category}),t.jsx("span",{className:"text-xs",children:e.type==="expense"?"Expense":"Income"})]})]}),t.jsxs("div",{className:`
                        text-lg sm:text-xl font-bold whitespace-nowrap
                        ${e.type==="expense"?"text-red-600":"text-green-600"}
                      `,children:[e.type==="expense"?"-":"+"," ",p,u(e.amount,{minimumFractionDigits:d.DECIMAL_PLACES,maximumFractionDigits:d.DECIMAL_PLACES})]})]},e.id))]})]}),c&&N(c).bills.length===0&&N(c).recurring.length===0&&t.jsxs("div",{className:"mt-6 border-t pt-6 text-center py-8",children:[t.jsx("i",{className:"ion-calendar text-4xl text-gray-400 mb-3"}),t.jsxs("p",{className:"text-gray-600 font-medium",children:["No payments for ",c," ",A[o-1]," ",l]})]}),h.length===0&&D.length===0&&t.jsxs("div",{className:"text-center py-8",children:[t.jsx("i",{className:"ion-calendar text-4xl text-gray-400 mb-3"}),t.jsxs("p",{className:"text-gray-600 font-medium",children:[n.NO_PAYMENTS_FOR," ",A[o-1]," ",l]}),t.jsx("p",{className:"text-sm text-gray-500 mt-2",children:n.ADD_BILLS_TO_CALENDAR})]})]})]})})};export{te as default};
