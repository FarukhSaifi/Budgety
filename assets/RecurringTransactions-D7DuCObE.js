import{u as F,r as d,n as x,j as e,U as n,h as U,T as p,N as S,o as Y,A as g,I as G,E as k,b as B,C as H}from"./index-8lZlQ1VF.js";import{u as q}from"./useDateFormatter-CGYOy8qr.js";import{B as M}from"./Button-BDqJC-5O.js";import{C as $}from"./ConfirmDialog-BN14OwTu.js";import{E as X}from"./EmptyState-C1ZadX25.js";import{P as V,S as W}from"./SectionCard-C45VGQ9e.js";import{s as j}from"./toast-CFIaTDC2.js";import{F as z,a as C}from"./FormField-Bft-gaAM.js";import{D as K,a as Z,b as J,c as Q}from"./DialogTitle-C94iNYoi.js";import{v as ee}from"./v4-CcQs6ztn.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./MenuItem-BWUw3nDk.js";const w=()=>({type:"",description:"",category:"",amount:"",recurrence:x.MONTHLY,startDate:new Date().toISOString().split("T")[0],endDate:""}),te=({open:m,onClose:R,recurring:a=null})=>{const{dispatch:f}=F(),T=d.useRef(!1),h=d.useRef(null),y=d.useMemo(()=>a?{type:a.type||"",description:a.description||"",category:a.category||"",amount:a.amount!==void 0&&a.amount!==null?String(a.amount):"",recurrence:a.recurrence||x.MONTHLY,startDate:a.startDate||new Date().toISOString().split("T")[0],endDate:a.endDate||""}:w(),[a]),[o,E]=d.useState(y),[N,u]=d.useState(""),b=!!a;d.useEffect(()=>{const l=m&&!T.current,t=(a==null?void 0:a.id)!==h.current;if(l||m&&t){const s=w();a&&(s.type=a.type||"",s.description=a.description||"",s.category=a.category||"",s.amount=a.amount!==void 0&&a.amount!==null?String(a.amount):"",s.recurrence=a.recurrence||x.MONTHLY,s.startDate=a.startDate||new Date().toISOString().split("T")[0],s.endDate=a.endDate||""),setTimeout(()=>{E(s),u("")},0)}T.current=m,h.current=(a==null?void 0:a.id)??null},[m,a,y]);const r=l=>{const{name:t,value:s}=l.target;E(D=>({...D,[t]:s===""?"":s,...t==="type"&&{category:""}})),N&&u("")},v=()=>o.type===p.INCOME?Object.values(G):o.type===p.EXPENSE?Object.values(k):[],O=l=>{l.preventDefault(),u("");const{type:t,description:s,category:D,amount:c,recurrence:i,startDate:_,endDate:P}=o;if(!t||!s||!D||!c||c===""||!i||!_){u(n.PLEASE_FILL_ALL_FIELDS);return}const I=Number(parseFloat(c).toFixed(S.DECIMAL_PLACES));if(isNaN(I)||I<=0){u(n.AMOUNT_MUST_BE_GREATER_THAN_ZERO);return}if(b){const L={...a,type:t,description:s.trim(),category:D,amount:I,recurrence:i,startDate:_,endDate:P||null};f({type:g.UPDATE_RECURRING_TRANSACTION,payload:L}),j("Recurring transaction updated successfully!")}else{const L={id:ee(),type:t,description:s.trim(),category:D,amount:I,recurrence:i,startDate:_,endDate:P||null,isActive:!0,createdAt:new Date().toISOString()};f({type:g.ADD_RECURRING_TRANSACTION,payload:L}),j("Recurring transaction added successfully!")}R()},A=()=>{E(w()),u(""),R()};return e.jsxs(K,{open:m,onClose:A,maxWidth:"md",fullWidth:!0,PaperProps:{className:"m-2 sm:m-4"},children:[e.jsx(Z,{className:"text-lg sm:text-xl font-semibold pb-3",children:b?`${n.EDIT} ${n.RECURRING_TRANSACTIONS}`:n.ADD_RECURRING_TRANSACTION_TITLE}),e.jsxs("form",{onSubmit:O,children:[e.jsxs(J,{className:"px-4 sm:px-6",children:[e.jsxs(z,{columns:2,spacing:3,className:"mb-4",children:[e.jsx(C,{label:"Type",name:"type",value:o.type,onChange:r,type:"select",required:!0,options:[{value:"",label:n.CHOOSE},{value:p.INCOME,label:U[p.INCOME]},{value:p.EXPENSE,label:U[p.EXPENSE]}]}),e.jsx(C,{label:"Category",name:"category",value:o.category,onChange:r,type:"select",required:!0,disabled:!o.type,options:[{value:"",label:n.CHOOSE},...v().map(l=>({value:l,label:l}))]}),e.jsx(C,{label:"Description",name:"description",value:o.description,onChange:r,type:"text",required:!0,fullWidth:!0,placeholder:"Description"}),e.jsx(C,{label:"Amount",name:"amount",type:"number",value:o.amount||"",onChange:r,required:!0,inputProps:{min:"0",step:S.STEP_VALUE}}),e.jsx(C,{label:"Recurrence",name:"recurrence",value:o.recurrence,onChange:r,type:"select",required:!0,options:Object.values(x).map(l=>({value:l,label:Y[l]}))}),e.jsx(C,{label:n.START_DATE,name:"startDate",type:"date",value:o.startDate,onChange:r,required:!0,InputLabelProps:{shrink:!0}}),e.jsx(C,{label:n.END_DATE_OPTIONAL,name:"endDate",type:"date",value:o.endDate,onChange:r,InputLabelProps:{shrink:!0}})]}),N&&e.jsx("div",{className:"mt-4 rounded-lg border border-red-200 bg-red-50 p-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ion-alert-circled text-red-600 text-lg mr-2"}),e.jsx("span",{className:"text-sm text-red-800",children:N})]})})]}),e.jsxs(Q,{className:"px-4 sm:px-6 pb-4 sm:pb-6 gap-2 sm:gap-3",children:[e.jsx(M,{variant:"outline",onClick:A,size:"md",className:"flex-1 sm:flex-initial py-2.5 sm:py-2 touch-manipulation",children:n.CANCEL}),e.jsx(M,{type:"submit",variant:"primary",size:"md",className:"flex-1 sm:flex-initial py-2.5 sm:py-2 touch-manipulation bg-indigo-600 hover:bg-indigo-700",children:n.SAVE})]})]})]})},xe=()=>{const{recurringTransactions:m,dispatch:R}=F(),{formatCurrency:a}=B(),{formatDate:f}=q(),[T,h]=d.useState(!1),[y,o]=d.useState(null),[E,N]=d.useState({open:!1,transactionId:null}),u=()=>{o(null),h(!0)},b=t=>{o(t),h(!0)},r=()=>{h(!1),o(null)},v=t=>{N({open:!0,transactionId:t})},O=()=>{E.transactionId&&(R({type:g.DELETE_RECURRING_TRANSACTION,payload:E.transactionId}),j("Recurring transaction deleted successfully"),N({open:!1,transactionId:null}))},A=(t,s)=>{R({type:g.UPDATE_RECURRING_TRANSACTION,payload:{id:t,isActive:!s}}),j(`Recurring transaction ${s?"paused":"activated"} successfully!`)},l=t=>{const s=new Date(t.startDate),D=new Date;let c=new Date(s);for(;c<=D;){const i=new Date(c);switch(t.recurrence){case x.DAILY:i.setDate(i.getDate()+1);break;case x.WEEKLY:i.setDate(i.getDate()+7);break;case x.MONTHLY:i.setMonth(i.getMonth()+1);break;case x.YEARLY:i.setFullYear(i.getFullYear()+1);break;default:return null}c=i}return t.endDate&&c>new Date(t.endDate)?null:c};return e.jsxs(V,{children:[e.jsx(W,{title:n.RECURRING_TRANSACTIONS,buttonText:n.ADD_RECURRING,onButtonClick:u,buttonIcon:e.jsx("i",{className:"ion-plus-round"}),bgColor:"bg-indigo-500",buttonColor:"indigo",children:m.length===0?e.jsx(X,{message:n.NO_RECURRING_TRANSACTIONS,icon:e.jsx("i",{className:"ion-information-circled"})}):e.jsx("div",{className:"space-y-2 md:space-y-4",children:m.map(t=>{const s=l(t);return e.jsx("div",{className:`border rounded-lg p-2 md:p-4 ${t.isActive?"border-indigo-200 bg-indigo-50":"border-gray-200 bg-gray-50 opacity-60"}`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start gap-2 mb-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-1",children:[e.jsx("h6",{className:"text-base md:text-lg font-semibold text-gray-800 truncate",children:t.description}),e.jsxs("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${t.type===p.INCOME?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[t.type===p.INCOME?"+":"-",H,a(t.amount,{minimumFractionDigits:S.DECIMAL_PLACES,maximumFractionDigits:S.DECIMAL_PLACES})]})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Category:"})," ",t.category]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Recurrence:"})," ",Y[t.recurrence]]}),s&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Next Occurrence:"})," ",f(s.toISOString().split("T")[0],"short")]}),t.endDate&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Ends:"})," ",f(t.endDate,"short")]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[e.jsx(M,{variant:"ghost",size:"sm",onClick:()=>b(t),className:"text-blue-500 hover:text-blue-700 p-1",title:n.EDIT,children:e.jsx("i",{className:"ion-edit text-xl"})}),e.jsx("button",{className:`px-2 md:px-3 py-1 text-xs md:text-sm font-medium rounded-md transition-colors whitespace-nowrap ${t.isActive?"bg-yellow-500 hover:bg-yellow-600 text-white":"bg-green-500 hover:bg-green-600 text-white"}`,onClick:()=>A(t.id,t.isActive),children:t.isActive?n.PAUSE:n.ACTIVATE}),e.jsx("button",{className:"text-red-500 hover:text-red-700 p-1 transition-colors",onClick:()=>v(t.id),title:n.DELETE,children:e.jsx("i",{className:"ion-close-round text-lg md:text-xl"})})]})]})},t.id)})})}),e.jsx(te,{open:T,onClose:r,recurring:y}),e.jsx($,{open:E.open,onClose:()=>N({open:!1,transactionId:null}),onConfirm:O,title:n.DELETE_RECURRING_TITLE,message:n.CONFIRM_DELETE_RECURRING,type:"warning",variant:"danger",confirmText:n.DELETE})]})};export{xe as default};
