import{u as F,r as u,R as U,j as e,U as r,E as G,N as a,A as P,a as w,b as Y,C as S,P as _,V as X}from"./index-8lZlQ1VF.js";import{B as v}from"./Button-BDqJC-5O.js";import{C as H}from"./ConfirmDialog-BN14OwTu.js";import{P as $,S as V}from"./SectionCard-C45VGQ9e.js";import{s as R}from"./toast-CFIaTDC2.js";import{F as q,a as b}from"./FormField-Bft-gaAM.js";import{D as W,a as k,b as z,c as J}from"./DialogTitle-C94iNYoi.js";import{v as K}from"./v4-CcQs6ztn.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./MenuItem-BWUw3nDk.js";const O=(i,d,t=null)=>t?{category:t.category||"",amount:t.amount!==void 0&&t.amount!==null?String(t.amount):"",month:t.month?String(t.month):String(i||""),year:t.year?String(t.year):String(d||"")}:{category:"",amount:"",month:i?String(i):"",year:d?String(d):""},Q=({open:i,onClose:d,budget:t=null})=>{const{dispatch:D,selectedMonth:p,selectedYear:x}=F(),g=u.useRef(!1),j=u.useRef(null),M=u.useMemo(()=>O(p,x,t),[p,x,t]),[E,h]=u.useState(M),[f,l]=u.useState(""),T=!!t;U.useEffect(()=>{const o=i&&!g.current,m=(t==null?void 0:t.id)!==j.current;if(o||i&&m){const c=O(p,x,t);h(c),l("")}g.current=i,j.current=(t==null?void 0:t.id)??null},[i,t,p,x]);const y=o=>{const{name:m,value:c}=o.target;h(s=>({...s,[m]:c===""?"":c})),f&&l("")},B=o=>{o.preventDefault(),l("");const{category:m,amount:c,month:s,year:n}=E;if(!m||!c||c===""||!s||s===""||!n||n===""){l("Please fill in all required fields.");return}const C=Number(parseFloat(c).toFixed(a.DECIMAL_PLACES)),N=parseInt(s,10),A=parseInt(n,10);if(isNaN(C)||C<=0){l("Budget amount must be greater than 0.");return}if(isNaN(N)||N<a.MIN_MONTH||N>a.MAX_MONTH){l(`Month must be between ${a.MIN_MONTH} and ${a.MAX_MONTH}.`);return}if(isNaN(A)||A<a.MIN_YEAR||A>a.MAX_YEAR){l(`Year must be between ${a.MIN_YEAR} and ${a.MAX_YEAR}.`);return}if(T){const L={...t,category:m,amount:C,month:N,year:A};D({type:P.UPDATE_BUDGET,payload:L}),R("Budget updated successfully!")}else{const L={id:K(),category:m,amount:C,month:N,year:A,createdAt:new Date().toISOString()};D({type:P.ADD_BUDGET,payload:L}),R("Budget added successfully!")}d()},I=()=>{h(O(p,x)),l(""),d()};return e.jsxs(W,{open:i,onClose:I,maxWidth:"md",fullWidth:!0,PaperProps:{className:"m-2 sm:m-4"},children:[e.jsx(k,{className:"text-lg sm:text-xl font-semibold pb-3",children:T?`${r.EDIT} ${r.BUDGETS}`:r.ADD_NEW_BUDGET_TITLE}),e.jsxs("form",{onSubmit:B,children:[e.jsxs(z,{className:"px-4 sm:px-6",children:[e.jsxs(q,{columns:2,spacing:3,className:"mb-4",children:[e.jsx(b,{label:"Category",name:"category",value:E.category,onChange:y,type:"select",required:!0,options:[{value:"",label:r.CHOOSE},...Object.values(G).map(o=>({value:o,label:o}))]}),e.jsx(b,{label:r.BUDGET_LIMIT,name:"amount",type:"number",value:E.amount||"",onChange:y,required:!0,inputProps:{min:"0",step:a.STEP_VALUE}}),e.jsx(b,{label:"Month",name:"month",type:"number",value:E.month||"",onChange:y,required:!0,inputProps:{min:a.MIN_MONTH,max:a.MAX_MONTH}}),e.jsx(b,{label:"Year",name:"year",type:"number",value:E.year||"",onChange:y,required:!0,inputProps:{min:a.MIN_YEAR,max:a.MAX_YEAR}})]}),f&&e.jsx("div",{className:"mt-4 rounded-lg border border-red-200 bg-red-50 p-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ion-alert-circled text-red-600 text-lg mr-2"}),e.jsx("span",{className:"text-sm text-red-800",children:f})]})})]}),e.jsxs(J,{className:"px-4 sm:px-6 pb-4 sm:pb-6 gap-2 sm:gap-3",children:[e.jsx(v,{variant:"outline",onClick:I,size:"md",className:"flex-1 sm:flex-initial py-2.5 sm:py-2 touch-manipulation",children:r.CANCEL}),e.jsx(v,{type:"submit",variant:"primary",size:"md",className:"flex-1 sm:flex-initial py-2.5 sm:py-2 touch-manipulation bg-purple-600 hover:bg-purple-700",children:r.SAVE})]})]})]})},me=()=>{const{budgets:i,transactions:d,selectedMonth:t,selectedYear:D,dispatch:p}=F(),{spendingByCategory:x}=w(d,X.MONTHLY,t,D),{formatCurrency:g}=Y(),[j,M]=u.useState(!1),[E,h]=u.useState(null),[f,l]=u.useState({open:!1,budgetId:null}),T=()=>{h(null),M(!0)},y=s=>{h(s),M(!0)},B=()=>{M(!1),h(null)},I=s=>{l({open:!0,budgetId:s})},o=()=>{f.budgetId&&(p({type:P.DELETE_BUDGET,payload:f.budgetId}),R("Budget deleted successfully"),l({open:!1,budgetId:null}))},m=u.useMemo(()=>i.filter(s=>s.month===t&&s.year===D),[i,t,D]),c=s=>{const n=x[s.category]||0,C=s.amount-n,N=n/s.amount*_.MAX;return{spent:n,remaining:C,percentage:Math.min(N,_.MAX),isOverBudget:n>s.amount}};return e.jsxs($,{children:[e.jsx(V,{title:r.BUDGETS,buttonText:r.ADD_BUDGET,onButtonClick:T,buttonIcon:e.jsx("i",{className:"ion-plus-round"}),bgColor:"bg-purple-500",buttonColor:"purple",children:m.length===0?e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-2 md:p-4 text-center",children:[e.jsx("i",{className:"ion-information-circled mr-2 text-blue-600"}),e.jsx("span",{className:"text-sm md:text-base text-blue-800",children:r.NO_BUDGETS})]}):e.jsx("div",{className:"space-y-2 md:space-y-4",children:m.map(s=>{const n=c(s);return e.jsxs("div",{className:"border border-gray-200 rounded-lg p-2 md:p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"text-lg font-semibold text-gray-800",children:s.category}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Budget: ",S,g(s.amount,{minimumFractionDigits:a.DECIMAL_PLACES,maximumFractionDigits:a.DECIMAL_PLACES})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>y(s),className:"text-blue-500 hover:text-blue-700 p-1",title:r.EDIT,children:e.jsx("i",{className:"ion-edit text-xl"})}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>I(s.id),className:"text-red-500 hover:text-red-700 p-1",title:r.DELETE,children:e.jsx("i",{className:"ion-close-round text-xl"})})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between mb-2 text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:[r.SPENT,": ",S,g(n.spent,{minimumFractionDigits:a.DECIMAL_PLACES,maximumFractionDigits:a.DECIMAL_PLACES})]}),e.jsxs("span",{className:`font-semibold ${n.isOverBudget?"text-red-600":"text-green-600"}`,children:[r.REMAINING,": ",S,g(Math.abs(n.remaining),{minimumFractionDigits:a.DECIMAL_PLACES,maximumFractionDigits:a.DECIMAL_PLACES})]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-6 overflow-hidden",children:e.jsxs("div",{className:`h-full flex items-center justify-center text-xs font-semibold text-white transition-all duration-300 ${n.isOverBudget?"bg-red-500":n.percentage>=_.WARNING?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(n.percentage,_.MAX)}%`},children:[n.percentage.toFixed(1),"%"]})})]}),n.isOverBudget&&e.jsxs("div",{className:"text-sm text-red-600 font-medium",children:["⚠️ Over budget by ",S,g(Math.abs(n.remaining),{minimumFractionDigits:a.DECIMAL_PLACES,maximumFractionDigits:a.DECIMAL_PLACES})]})]},s.id)})})}),e.jsx(Q,{open:j,onClose:B,budget:E}),e.jsx(H,{open:f.open,onClose:()=>l({open:!1,budgetId:null}),onConfirm:o,title:r.DELETE_BUDGET_TITLE,message:r.CONFIRM_DELETE_BUDGET,type:"warning",variant:"danger",confirmText:r.DELETE})]})};export{me as default};
