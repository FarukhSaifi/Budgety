import{u as F,r as i,m as y,j as e,U as a,E as U,N as f,o as P,n as S,A,b as k,D as Y,C as O}from"./index-8lZlQ1VF.js";import{u as G}from"./useDateFormatter-CGYOy8qr.js";import{B as v}from"./Button-BDqJC-5O.js";import{C as H}from"./ConfirmDialog-BN14OwTu.js";import{E as q}from"./EmptyState-C1ZadX25.js";import{P as z,S as V}from"./SectionCard-C45VGQ9e.js";import{s as b}from"./toast-CFIaTDC2.js";import{F as K,a as h}from"./FormField-Bft-gaAM.js";import{D as X,a as $,b as W,c as Z}from"./DialogTitle-C94iNYoi.js";import{v as J}from"./v4-CcQs6ztn.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./MenuItem-BWUw3nDk.js";const w=()=>({name:"",category:"",amount:"",dueDate:"",reminderDays:String(y.DEFAULT_REMINDER_DAYS),isRecurring:!1,recurrence:"monthly"}),Q=({open:c,onClose:N,bill:s=null})=>{const{dispatch:L}=F(),_=i.useRef(!1),E=i.useRef(null),M=i.useMemo(()=>s?{name:s.name||"",category:s.category||"",amount:s.amount!==void 0&&s.amount!==null?String(s.amount):"",dueDate:s.dueDate||"",reminderDays:s.reminderDays?String(s.reminderDays):String(y.DEFAULT_REMINDER_DAYS),isRecurring:s.isRecurring||!1,recurrence:s.recurrence||"monthly"}:w(),[s]),[o,g]=i.useState(M),[p,D]=i.useState(""),I=!!s;i.useEffect(()=>{const l=c&&!_.current,m=(s==null?void 0:s.id)!==E.current;if(l||c&&m){const r=w();s&&(r.name=s.name||"",r.category=s.category||"",r.amount=s.amount!==void 0&&s.amount!==null?String(s.amount):"",r.dueDate=s.dueDate||"",r.reminderDays=s.reminderDays?String(s.reminderDays):String(y.DEFAULT_REMINDER_DAYS),r.isRecurring=s.isRecurring||!1,r.recurrence=s.recurrence||"monthly"),setTimeout(()=>{g(r),D("")},0)}_.current=c,E.current=(s==null?void 0:s.id)??null},[c,s]);const u=i.useCallback(l=>{const{name:m,value:r,type:x,checked:t}=l.target;g(n=>({...n,[m]:x==="checkbox"?t:r===""?"":r})),p&&D("")},[p]),T=l=>{l.preventDefault(),D("");const{name:m,category:r,amount:x,dueDate:t,reminderDays:n,isRecurring:d,recurrence:C}=o;if(!m||!r||!x||x===""||!t){D(a.PLEASE_FILL_ALL_FIELDS);return}const R=Number(parseFloat(x).toFixed(f.DECIMAL_PLACES));if(isNaN(R)||R<=0){D(a.BILL_AMOUNT_MUST_BE_GREATER_THAN_ZERO);return}if(I){const B={...s,name:m,category:r,amount:R,dueDate:t,reminderDays:parseInt(n,10),isRecurring:d,recurrence:d?C:null};L({type:A.UPDATE_BILL_REMINDER,payload:B}),b("Bill reminder updated successfully!")}else{const B={id:J(),name:m,category:r,amount:R,dueDate:t,reminderDays:parseInt(n,10),isRecurring:d,recurrence:d?C:null,isPaid:!1,createdAt:new Date().toISOString()};L({type:A.ADD_BILL_REMINDER,payload:B}),b("Bill reminder added successfully!")}N()},j=()=>{g(w()),D(""),N()};return e.jsxs(X,{open:c,onClose:j,maxWidth:"md",fullWidth:!0,PaperProps:{className:"m-2 sm:m-4"},children:[e.jsx($,{className:"text-lg sm:text-xl font-semibold pb-3",children:I?`${a.EDIT} ${a.BILL_REMINDERS}`:a.ADD_BILL_REMINDER_TITLE}),e.jsxs("form",{onSubmit:T,children:[e.jsxs(W,{className:"px-4 sm:px-6",children:[e.jsxs(K,{columns:2,spacing:3,className:"mb-4",children:[e.jsx(h,{label:a.BILL_NAME,name:"name",value:o.name,onChange:u,type:"text",required:!0,placeholder:"e.g., Electricity Bill"}),e.jsx(h,{label:"Category",name:"category",value:o.category,onChange:u,type:"select",required:!0,options:[{value:"",label:a.CHOOSE},...Object.values(U).map(l=>({value:l,label:l}))]}),e.jsx(h,{label:"Amount",name:"amount",type:"number",value:o.amount||"",onChange:u,required:!0,inputProps:{min:"0",step:f.STEP_VALUE}}),e.jsx(h,{label:a.DUE_DATE,name:"dueDate",type:"date",value:o.dueDate,onChange:u,required:!0,InputLabelProps:{shrink:!0}}),e.jsx(h,{label:a.REMIND_ME_DAYS_BEFORE,name:"reminderDays",type:"number",value:o.reminderDays||"",onChange:u,inputProps:{min:"0",max:y.MAX_REMINDER_DAYS}}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-300 rounded",name:"isRecurring",checked:o.isRecurring,onChange:u}),e.jsx("label",{className:"ml-2 block text-sm text-gray-700",children:a.RECURRING_BILL})]}),o.isRecurring&&e.jsx(h,{label:"Recurrence",name:"recurrence",value:o.recurrence,onChange:u,type:"select",options:[{value:S.MONTHLY,label:P[S.MONTHLY]},{value:S.YEARLY,label:P[S.YEARLY]}]})]}),p&&e.jsx("div",{className:"mt-4 rounded-lg border border-red-200 bg-red-50 p-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("i",{className:"ion-alert-circled text-red-600 text-lg mr-2"}),e.jsx("span",{className:"text-sm text-red-800",children:p})]})})]}),e.jsxs(Z,{className:"px-4 sm:px-6 pb-4 sm:pb-6 gap-2 sm:gap-3",children:[e.jsx(v,{variant:"outline",onClick:j,size:"md",className:"flex-1 sm:flex-initial py-2.5 sm:py-2 touch-manipulation",children:a.CANCEL}),e.jsx(v,{type:"submit",variant:"primary",size:"md",className:"flex-1 sm:flex-initial py-2.5 sm:py-2 touch-manipulation bg-orange-600 hover:bg-orange-700",children:a.SAVE})]})]})]})},ue=()=>{const{billReminders:c,dispatch:N}=F(),{formatCurrency:s}=k(),{formatDate:L}=G(),[_,E]=i.useState(!1),[M,o]=i.useState(null),[g,p]=i.useState({open:!1,billId:null}),D=()=>{o(null),E(!0)},I=t=>{o(t),E(!0)},u=()=>{E(!1),o(null)},T=t=>{p({open:!0,billId:t})},j=()=>{g.billId&&(N({type:A.DELETE_BILL_REMINDER,payload:g.billId}),b("Bill reminder deleted successfully"),p({open:!1,billId:null}))},l=t=>{N({type:A.MARK_BILL_PAID,payload:t}),b("Bill marked as paid!")},m=i.useCallback(t=>{const n=new Date;n.setHours(0,0,0,0);const d=new Date(t);d.setHours(0,0,0,0);const C=d-n;return Math.ceil(C/y.MILLISECONDS_PER_DAY)},[]),r=i.useMemo(()=>c.filter(t=>!t.isPaid).sort((t,n)=>new Date(t.dueDate)-new Date(n.dueDate)).slice(0,Y.UPCOMING_BILLS),[c]),x=i.useMemo(()=>c.filter(t=>t.isPaid?!1:m(t.dueDate)<0),[c,m]);return e.jsxs(z,{children:[e.jsxs(V,{title:a.BILL_REMINDERS,buttonText:a.ADD_BILL,onButtonClick:D,buttonIcon:e.jsx("i",{className:"ion-plus-round"}),bgColor:"bg-orange-500",buttonColor:"orange",children:[x.length>0&&e.jsxs("div",{className:"mb-2 md:mb-4 p-2 md:p-4 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("h6",{className:"text-base md:text-lg font-semibold text-red-800 mb-2",children:[a.OVERDUE_BILLS," (",x.length,")"]}),e.jsx("div",{className:"space-y-2",children:x.map(t=>{const n=Math.abs(m(t.dueDate));return e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 p-2 md:p-3 bg-white rounded border border-red-300",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold text-sm md:text-base text-gray-800 truncate",children:t.name}),e.jsxs("div",{className:"text-xs md:text-sm text-gray-600",children:["Due: ",L(t.dueDate,"short")," (",n," ","days overdue)"]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("span",{className:"font-bold text-sm md:text-base text-red-600 whitespace-nowrap",children:[O,s(t.amount,{minimumFractionDigits:f.DECIMAL_PLACES,maximumFractionDigits:f.DECIMAL_PLACES})]}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>I(t),className:"text-blue-500 hover:text-blue-700 p-1",title:a.EDIT,children:e.jsx("i",{className:"ion-edit text-xl"})}),e.jsx("button",{onClick:()=>l(t.id),className:"bg-green-600 hover:bg-green-700 text-white text-xs md:text-sm font-medium py-1.5 md:py-2 px-2 md:px-3 rounded transition-colors whitespace-nowrap",children:a.MARK_AS_PAID})]})]},t.id)})})]}),r.length>0&&e.jsxs("div",{className:"mb-2 md:mb-4",children:[e.jsx("h6",{className:"text-base md:text-lg font-semibold text-gray-800 mb-2",children:a.UPCOMING_BILLS}),e.jsx("div",{className:"space-y-2",children:r.map(t=>{const n=m(t.dueDate),d=n<=parseInt(t.reminderDays||y.DEFAULT_REMINDER_DAYS);return e.jsxs("div",{className:`flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 p-2 md:p-4 rounded-lg border ${d?"bg-yellow-50 border-yellow-300":"bg-white border-gray-200"}`,children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-1",children:[e.jsx("h6",{className:"font-semibold text-sm md:text-base text-gray-800 truncate",children:t.name}),e.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded whitespace-nowrap",children:t.category}),t.isRecurring&&e.jsx("span",{className:"px-2 py-1 text-xs bg-purple-100 text-purple-800 rounded whitespace-nowrap",children:"Recurring"})]}),e.jsxs("div",{className:"text-xs md:text-sm text-gray-600",children:["Due: ",L(t.dueDate,"short")," (",n," ","days)",d&&e.jsx("span",{className:"ml-2 text-yellow-600 font-medium",children:a.DUE_SOON})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("span",{className:"font-bold text-sm md:text-base text-gray-800 whitespace-nowrap",children:[O,s(t.amount,{minimumFractionDigits:f.DECIMAL_PLACES,maximumFractionDigits:f.DECIMAL_PLACES})]}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>I(t),className:"text-blue-500 hover:text-blue-700 p-1",title:a.EDIT,children:e.jsx("i",{className:"ion-edit text-xl"})}),e.jsx("button",{onClick:()=>l(t.id),className:"bg-green-600 hover:bg-green-700 text-white text-xs md:text-sm font-medium py-1.5 md:py-2 px-2 md:px-4 rounded transition-colors whitespace-nowrap",children:a.MARK_AS_PAID}),e.jsx("button",{onClick:()=>T(t.id),className:"text-red-500 hover:text-red-700 p-1 transition-colors",title:a.DELETE,children:e.jsx("i",{className:"ion-close-round text-lg md:text-xl"})})]})]},t.id)})})]}),c.length===0&&e.jsx(q,{message:a.NO_BILL_REMINDERS,icon:e.jsx("i",{className:"ion-information-circled"})})]}),e.jsx(Q,{open:_,onClose:u,bill:M}),e.jsx(H,{open:g.open,onClose:()=>p({open:!1,billId:null}),onConfirm:j,title:a.DELETE_BILL_TITLE,message:a.CONFIRM_DELETE_BILL,type:"warning",variant:"danger",confirmText:a.DELETE})]})};export{ue as default};
