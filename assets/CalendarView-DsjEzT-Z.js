import{u as H,r as i,b as X,l as K,T as y,j as e,M as E,C as T,U as f,A as M}from"./index-8lZlQ1VF.js";import{u as Q}from"./useDateFormatter-CGYOy8qr.js";import{B as u}from"./Button-BDqJC-5O.js";import{C as q,b as G,a as J}from"./Card-BGTWcXJa.js";import{C as Z}from"./ConfirmDialog-BN14OwTu.js";import{s as ee}from"./toast-CFIaTDC2.js";import{E as te}from"./EditTransactionModal-D3_EUjHA.js";import{C as se,a as ae}from"./ChevronRight-Dp011kP9.js";import"./DialogTitle-C94iNYoi.js";import"./createSimplePaletteValueFilter-bm0fmN_7.js";import"./FormField-Bft-gaAM.js";import"./MenuItem-BWUw3nDk.js";const ge=()=>{const{transactions:S,selectedMonth:l,selectedYear:r,searchQuery:b,dispatch:C}=H(),[o,N]=i.useState(null),[Y,O]=i.useState(null),[R,A]=i.useState(!1),[D,w]=i.useState({open:!1,transactionId:null}),{formatCurrency:c}=X(),{formatDate:k}=Q(),m=i.useMemo(()=>{let t=S.filter(s=>{if(!s.date)return!1;const a=new Date(s.date);return a.getMonth()+1===l&&a.getFullYear()===r});return b&&b.trim()!==""&&(t=K(t,b)),t},[S,l,r,b]),d=i.useMemo(()=>{const t={};return m.forEach(s=>{const n=new Date(s.date).getDate();t[n]||(t[n]={income:[],expense:[],totalIncome:0,totalExpense:0}),s.type===y.INCOME?(t[n].income.push(s),t[n].totalIncome+=s.amount||0):(t[n].expense.push(s),t[n].totalExpense+=s.amount||0)}),t},[m]),B=i.useMemo(()=>{const t=r,s=l-1,a=new Date(t,s,1),g=new Date(t,s+1,0).getDate(),v=a.getDay(),x=[];for(let h=0;h<v;h++)x.push(null);for(let h=1;h<=g;h++)x.push(h);return x},[l,r]),I=t=>!t||!d[t]?[]:[...d[t].income,...d[t].expense].sort((s,a)=>new Date(a.createdAt||a.date)-new Date(s.createdAt||s.date)),$=t=>!t||!d[t]?0:d[t].totalIncome-d[t].totalExpense,_=t=>{let s=l,a=r;t==="prev"?(s-=1,s<1&&(s=12,a-=1)):(s+=1,s>12&&(s=1,a+=1)),C({type:M.SET_VIEW_PERIOD,payload:{viewPeriod:"monthly",selectedMonth:s,selectedYear:a}}),N(null)},F=()=>{const t=new Date;C({type:M.SET_VIEW_PERIOD,payload:{viewPeriod:"monthly",selectedMonth:t.getMonth()+1,selectedYear:t.getFullYear()}}),N(t.getDate())},L=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],p=new Date,P=l===p.getMonth()+1&&r===p.getFullYear(),j=i.useMemo(()=>{const t=m.filter(a=>a.type===y.INCOME).reduce((a,n)=>a+(n.amount||0),0),s=m.filter(a=>a.type===y.EXPENSE).reduce((a,n)=>a+(n.amount||0),0);return{income:t,expense:s,balance:t-s}},[m]),z=t=>{O(t),A(!0)},V=()=>{A(!1),O(null)},W=t=>{w({open:!0,transactionId:t})},U=()=>{D.transactionId&&(C({type:M.DELETE_TRANSACTION,payload:D.transactionId}),ee("Transaction deleted successfully"),w({open:!1,transactionId:null}))};return e.jsxs("div",{className:"mx-auto mb-6",children:[e.jsxs(q,{children:[e.jsx(G,{bgColor:"bg-blue-500",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-white mb-1",children:"Calendar View"}),e.jsxs("p",{className:"text-sm text-blue-100",children:[E[l-1]," ",r]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:F,className:"bg-white text-blue-600 hover:bg-blue-50 border-white",children:"Today"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>_("prev"),className:"text-white hover:bg-blue-600",children:e.jsx(se,{})}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>_("next"),className:"text-white hover:bg-blue-600",children:e.jsx(ae,{})})]})]})]})}),e.jsxs(J,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Total Income"}),e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-green-600",children:[T,c(j.income)]})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border border-red-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Total Expenses"}),e.jsxs("div",{className:"text-xl sm:text-2xl font-bold text-red-600",children:[T,c(j.expense)]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("div",{className:"text-sm text-gray-600 mb-1",children:"Net Balance"}),e.jsxs("div",{className:`text-xl sm:text-2xl font-bold ${j.balance>=0?"text-green-600":"text-red-600"}`,children:[T,c(Math.abs(j.balance))]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-2",children:L.map(t=>e.jsx("div",{className:"text-center font-semibold text-gray-700 py-2 text-sm sm:text-base",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-1.5 sm:gap-2",children:B.map((t,s)=>{if(t===null)return e.jsx("div",{className:"h-16 sm:h-20 md:h-28 border border-transparent rounded-lg"},`empty-${s}`);const a=d[t],n=!!a,g=$(t),v=P&&t===p.getDate()&&l===p.getMonth()+1&&r===p.getFullYear(),x=o===t;return e.jsx("div",{onClick:()=>N(o===t?null:t),className:`
                      h-16 sm:h-20 md:h-28 border-2 rounded-lg p-1 sm:p-2 cursor-pointer transition-all touch-manipulation active:scale-95
                      ${x?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 active:border-gray-400 active:shadow-sm"}
                      ${v?"ring-2 ring-green-400 ring-offset-1":""}
                      ${n?"bg-gray-50":"bg-white"}
                    `,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex justify-between items-start mb-0.5 sm:mb-1",children:[e.jsx("span",{className:`text-xs sm:text-sm md:text-base font-semibold ${v?"text-green-600":x?"text-blue-600":"text-gray-800"}`,children:t}),n&&e.jsxs("span",{className:`text-[10px] sm:text-xs font-bold ${g>=0?"text-green-600":"text-red-600"}`,children:[g>=0?"+":"",c(Math.abs(g),{compact:!0})]})]}),n&&e.jsxs("div",{className:"flex-1 flex flex-col justify-end space-y-0.5",children:[a.totalIncome>0&&e.jsxs("div",{className:"text-[10px] sm:text-xs text-green-600 font-medium truncate",children:["+",c(a.totalIncome,{compact:!0})]}),a.totalExpense>0&&e.jsxs("div",{className:"text-[10px] sm:text-xs text-red-600 font-medium truncate",children:["-",c(a.totalExpense,{compact:!0})]}),e.jsxs("div",{className:"text-[10px] sm:text-xs text-gray-500 font-medium",children:[a.income.length+a.expense.length," ","txn"]})]})]})},t)})})]}),o&&I(o).length>0&&e.jsxs("div",{className:"mt-6 border-t pt-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"text-lg sm:text-xl font-semibold text-gray-800",children:["Transactions for ",o," ",E[l-1]," ",r]}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>N(null),className:"text-gray-600",children:"Close"})]}),e.jsx("div",{className:"space-y-3",children:I(o).map(t=>{const s=t.type===y.INCOME;return e.jsxs("div",{className:`
                        flex flex-col sm:flex-row sm:justify-between sm:items-center p-3 md:p-4 rounded-lg border-l-4 shadow-sm gap-2 md:gap-4
                        ${s?"bg-green-50 border-green-500":"bg-red-50 border-red-500"}
                      `,children:[e.jsxs("div",{className:"flex-1 mb-2 sm:mb-0 min-w-0",children:[e.jsx("div",{className:"font-semibold text-sm md:text-base text-gray-800 mb-1 break-words",children:t.description||"No description"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs md:text-sm text-gray-600",children:[t.category&&e.jsx("span",{className:"px-2 py-1 bg-white rounded text-xs font-medium",children:t.category}),t.mode&&e.jsx("span",{className:"px-2 py-1 bg-white rounded text-xs font-medium",children:t.mode}),e.jsx("span",{className:"text-xs",children:k(t.date,"short")})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs("div",{className:`
                            text-base md:text-lg font-bold whitespace-nowrap
                            ${s?"text-green-600":"text-red-600"}
                          `,children:[s?"+":"-"," ",T,c(t.amount)]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>z(t),className:"text-blue-500 hover:text-blue-700 active:text-blue-800 p-1.5 md:p-2 touch-manipulation",title:f.EDIT,children:e.jsx("i",{className:"ion-edit text-base md:text-lg"})}),e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>W(t.id),className:"text-red-500 hover:text-red-700 active:text-red-800 p-1.5 md:p-2 touch-manipulation",title:f.DELETE,children:e.jsx("i",{className:"ion-close-round text-base md:text-lg"})})]})]})]},t.id)})})]}),o&&I(o).length===0&&e.jsxs("div",{className:"mt-6 border-t pt-6 text-center py-8",children:[e.jsx("i",{className:"ion-calendar text-4xl text-gray-400 mb-3"}),e.jsxs("p",{className:"text-gray-600 font-medium",children:["No transactions for ",o," ",E[l-1]," ",r]})]}),m.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("i",{className:"ion-calendar text-4xl text-gray-400 mb-3"}),e.jsxs("p",{className:"text-gray-600 font-medium",children:["No transactions for ",E[l-1]," ",r]}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Add transactions to see them on the calendar"})]})]})]}),e.jsx(te,{open:R,onClose:V,transaction:Y}),e.jsx(Z,{open:D.open,onClose:()=>w({open:!1,transactionId:null}),onConfirm:U,title:f.DELETE_TRANSACTION_TITLE,message:f.CONFIRM_DELETE_TRANSACTION,type:"warning",variant:"danger",confirmText:f.DELETE})]})};export{ge as default};
